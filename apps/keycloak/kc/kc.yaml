apiVersion: k8s.keycloak.org/v2alpha1
kind: Keycloak
metadata:
  name: kc
spec:
  instances: 1
  # db:
  #   vendor: postgres
  #   host: postgres-db
  #   usernameSecret:
  #     name: keycloak-db-secret
  #     key: username
  #   passwordSecret:
  #     name: keycloak-db-secret
  #     key: password
  http:
    tlsSecret: keycloak-tls
  hostname:
    hostname: keycloak.127.0.0.1.nip.io
  proxy:
    headers: xforwarded # double check your reverse proxy sets and overwrites the X-Forwarded-* headers
  
  ingress:
    enabled: true
    className: nginx

    annotations:
      nginx.ingress.kubernetes.io/backend-protocol: "HTTPS"

    rules:
      - host: keycloak.127.0.0.1.nip.io
        paths:
          - path: /
            pathType: Prefix

    tls:
      - hosts:
          - keycloak.127.0.0.1.nip.io
        secretName: keycloak-tls